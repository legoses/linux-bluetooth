<html>
    <head>Bluetooth Controller</head>
    <body>
        <h1>Found devices:</h1>
        </br>
        <div style="width:75%;height:300px;line-height:3em;overflow:scroll;padding:5px;" id="testBox"></div>

        <button onclick="button_click(1)">Start Scanning</button>
        <button onclick="button_click(2)">Stop Scanning</button>
        <script>
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }


            //while(true) {
                //sleep(1000).then(() => { console.log("sleep test"); });
            //}

            jsonArr = [];

           var ws = new WebSocket("ws://127.0.0.1:8080");
           console.log("test log");
            
            function button_click(arg) {
                ws.send(arg);
                console.log("Button pressed");
            }

            ws.onopen = (event) => {
                console.log("Websocket opened");
                ws.send("open");
           
            }

            ws.onclose = (event) => {
                console.log("Connection closed");
            }
            
            ws.onmessage = (event) => {
                msg = event.data;
                if(msg[0] == "{") {
                    obj = JSON.parse(msg);
                    bleLine = "Device Name: " + obj.Name + " MAC: " + obj.Address;
                    document.getElementById("testBox").innerHTML += bleLine;
                    console.log("json detected");
                 }
                console.log("MESSAGE: " + event.data);
            }

            ws.onerror = (error) => {
                console.log("Error code ", error.code);
                console.log("Error ", error.stack);
                console.log("Error ", error.name);
                console.log("Error ", error.message);
            };
        </script>
    </body>
</html>
